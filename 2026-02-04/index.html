<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>PromptWorm ‚Äî AI Agent Network Infection Simulator</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  :root{
    --bg:#0a0a0f;--surface:#12121a;--border:#1e1e2e;
    --text:#e0e0e8;--dim:#6a6a8a;--accent:#00ff88;
    --danger:#ff3366;--warn:#ffaa00;--info:#00aaff;
    --infected:#ff3366;--immune:#00aaff;--clean:#00ff88;
    --patched:#aa66ff;
  }
  body{background:var(--bg);color:var(--text);font-family:'SF Mono',monospace;overflow:hidden;height:100dvh;display:flex;flex-direction:column}
  
  /* Header */
  .header{padding:12px 16px;display:flex;align-items:center;gap:12px;border-bottom:1px solid var(--border);z-index:10;background:var(--surface)}
  .header h1{font-size:14px;font-weight:700;color:var(--accent);letter-spacing:1px}
  .header .tag{font-size:10px;padding:2px 8px;border-radius:99px;background:rgba(255,51,102,0.15);color:var(--danger);border:1px solid rgba(255,51,102,0.3)}
  
  /* Canvas */
  .canvas-wrap{flex:1;position:relative;overflow:hidden}
  canvas{display:block;width:100%;height:100%}
  
  /* HUD Overlay */
  .hud{position:absolute;top:12px;left:12px;display:flex;flex-direction:column;gap:8px;pointer-events:none}
  .stat{background:rgba(18,18,26,0.9);border:1px solid var(--border);border-radius:8px;padding:8px 12px;backdrop-filter:blur(8px);pointer-events:auto}
  .stat-label{font-size:9px;text-transform:uppercase;letter-spacing:1px;color:var(--dim);margin-bottom:2px}
  .stat-val{font-size:18px;font-weight:700;font-variant-numeric:tabular-nums}
  .stat-val.clean{color:var(--clean)}.stat-val.infected{color:var(--infected)}.stat-val.immune{color:var(--info)}.stat-val.patched{color:var(--patched)}
  
  /* Control Panel */
  .controls{background:var(--surface);border-top:1px solid var(--border);padding:12px 16px;display:flex;flex-direction:column;gap:10px;z-index:10}
  .control-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{padding:8px 16px;border-radius:8px;border:1px solid var(--border);background:rgba(255,255,255,0.04);color:var(--text);font-family:inherit;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.15s;flex:1;min-width:80px;text-align:center}
  .btn:active{transform:scale(0.96)}
  .btn.primary{background:rgba(0,255,136,0.12);border-color:rgba(0,255,136,0.3);color:var(--accent)}
  .btn.danger{background:rgba(255,51,102,0.12);border-color:rgba(255,51,102,0.3);color:var(--danger)}
  .btn.info{background:rgba(0,170,255,0.12);border-color:rgba(0,170,255,0.3);color:var(--info)}
  .btn.warn{background:rgba(170,102,255,0.12);border-color:rgba(170,102,255,0.3);color:var(--patched)}
  .btn:disabled{opacity:0.3;pointer-events:none}
  
  /* Sliders */
  .slider-row{display:flex;align-items:center;gap:10px}
  .slider-row label{font-size:10px;color:var(--dim);min-width:90px;text-transform:uppercase;letter-spacing:0.5px}
  .slider-row input[type=range]{flex:1;accent-color:var(--accent);height:4px}
  .slider-row .val{font-size:11px;color:var(--accent);min-width:30px;text-align:right;font-weight:600}
  
  /* Log */
  .log-wrap{position:absolute;bottom:12px;right:12px;width:280px;max-height:200px;overflow-y:auto;pointer-events:auto}
  .log-entry{font-size:9px;padding:3px 8px;background:rgba(18,18,26,0.85);border-left:2px solid var(--dim);margin-bottom:2px;border-radius:0 4px 4px 0;backdrop-filter:blur(4px)}
  .log-entry.infect{border-color:var(--danger);color:var(--danger)}
  .log-entry.defend{border-color:var(--clean);color:var(--clean)}
  .log-entry.patch{border-color:var(--patched);color:var(--patched)}
  .log-entry.system{border-color:var(--info);color:var(--info)}
  
  /* Tooltip */
  .tooltip{position:absolute;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:10px;font-size:11px;pointer-events:none;display:none;z-index:100;max-width:220px;backdrop-filter:blur(12px)}
  .tooltip .name{font-weight:700;margin-bottom:4px;font-size:12px}
  .tooltip .detail{color:var(--dim);line-height:1.5}
  
  /* Chart */
  .chart-bar{position:absolute;top:12px;right:12px;width:180px;height:24px;background:rgba(18,18,26,0.9);border:1px solid var(--border);border-radius:6px;overflow:hidden;display:flex;pointer-events:auto}
  .chart-seg{height:100%;transition:width 0.3s}
  .chart-seg.clean-seg{background:var(--clean)}
  .chart-seg.infected-seg{background:var(--infected)}
  .chart-seg.immune-seg{background:var(--info)}
  .chart-seg.patched-seg{background:var(--patched)}
  
  @media(max-width:500px){
    .log-wrap{width:160px;max-height:140px}
    .chart-bar{width:140px}
  }
</style>
</head>
<body>

<div class="header">
  <h1>üêõ PROMPTWORM</h1>
  <span class="tag">AI AGENT SECURITY SIM</span>
</div>

<div class="canvas-wrap">
  <canvas id="canvas"></canvas>
  
  <div class="hud">
    <div class="stat"><div class="stat-label">üü¢ Clean</div><div class="stat-val clean" id="sClean">0</div></div>
    <div class="stat"><div class="stat-label">üî¥ Infected</div><div class="stat-val infected" id="sInfected">0</div></div>
    <div class="stat"><div class="stat-label">üîµ Immune</div><div class="stat-val immune" id="sImmune">0</div></div>
    <div class="stat"><div class="stat-label">üü£ Patched</div><div class="stat-val patched" id="sPatched">0</div></div>
    <div class="stat"><div class="stat-label">‚è± Tick</div><div class="stat-val" id="sTick" style="color:var(--warn)">0</div></div>
  </div>
  
  <div class="chart-bar" id="chart">
    <div class="chart-seg clean-seg" id="cClean"></div>
    <div class="chart-seg infected-seg" id="cInfected"></div>
    <div class="chart-seg immune-seg" id="cImmune"></div>
    <div class="chart-seg patched-seg" id="cPatched"></div>
  </div>
  
  <div class="log-wrap" id="log"></div>
  <div class="tooltip" id="tooltip"></div>
</div>

<div class="controls">
  <div class="slider-row">
    <label>Virulence</label>
    <input type="range" id="virulence" min="5" max="95" value="45">
    <span class="val" id="vVirulence">45%</span>
  </div>
  <div class="slider-row">
    <label>Agent Count</label>
    <input type="range" id="agentCount" min="20" max="200" value="80" step="10">
    <span class="val" id="vAgentCount">80</span>
  </div>
  <div class="slider-row">
    <label>Defense Level</label>
    <input type="range" id="defense" min="0" max="80" value="25">
    <span class="val" id="vDefense">25%</span>
  </div>
  <div class="control-row">
    <button class="btn primary" id="btnGenerate">Generate Network</button>
    <button class="btn danger" id="btnInject">üêõ Inject Worm</button>
    <button class="btn warn" id="btnPatch">üõ°Ô∏è Deploy Patch</button>
    <button class="btn info" id="btnReset">Reset</button>
  </div>
</div>

<script>
const C = document.getElementById('canvas');
const ctx = C.getContext('2d');
const DPR = window.devicePixelRatio || 1;
let W, H;

// Colors
const COLORS = {
  clean: '#00ff88', infected: '#ff3366', immune: '#00aaff', patched: '#aa66ff',
  edge: 'rgba(255,255,255,0.04)', edgeActive: 'rgba(255,51,102,0.4)',
  bg: '#0a0a0f'
};

// State
let agents = [];
let edges = [];
let tick = 0;
let running = false;
let simInterval = null;
let patchDeployed = false;
let hoveredAgent = null;

// Agent names
const PREFIXES = ['GPT','Claude','Gemini','Llama','Mistral','Qwen','DeepSeek','Phi','Falcon','Yi','Grok','Cohere','Palm','Bard','Nova','Titan','Atlas','Nexus','Orion','Pulse','Echo','Drift','Flux','Byte','Neon','Quark','Spark','Vapor','Zinc','Astra'];
const SUFFIXES = ['Agent','Bot','Worker','Node','Core','Hub','Relay','Proxy','Daemon','Sentry','Scout','Guard','Pilot','Runner','Solver','Miner','Oracle','Weaver','Fixer','Seeker'];
const ROLES = ['Email Assistant','Calendar Manager','Code Reviewer','Data Analyst','Customer Support','Task Scheduler','Content Writer','Research Agent','DevOps Monitor','Security Scanner','File Organizer','Meeting Summarizer','Expense Tracker','Social Media Bot','Translation Service','Document Parser','Workflow Automator','Database Manager','API Gateway','Log Analyzer'];

function randName(){return PREFIXES[Math.random()*PREFIXES.length|0]+'-'+SUFFIXES[Math.random()*SUFFIXES.length|0]}
function randRole(){return ROLES[Math.random()*ROLES.length|0]}

function resize(){
  const r = C.parentElement.getBoundingClientRect();
  W = r.width; H = r.height;
  C.width = W * DPR; C.height = H * DPR;
  C.style.width = W+'px'; C.style.height = H+'px';
  ctx.setTransform(DPR,0,0,DPR,0,0);
}

function generateNetwork(){
  const count = +document.getElementById('agentCount').value;
  const defense = +document.getElementById('defense').value / 100;
  agents = [];
  edges = [];
  tick = 0;
  running = false;
  patchDeployed = false;
  clearInterval(simInterval);
  
  // Place agents using force-directed-ish layout
  const pad = 50;
  for(let i=0;i<count;i++){
    const angle = (i/count)*Math.PI*2 + (Math.random()-0.5)*0.5;
    const radius = 60 + Math.random()*(Math.min(W,H)/2 - 80);
    agents.push({
      id: i,
      name: randName(),
      role: randRole(),
      x: W/2 + Math.cos(angle)*radius*(0.4+Math.random()*0.6),
      y: H/2 + Math.sin(angle)*radius*(0.4+Math.random()*0.6),
      vx: 0, vy: 0,
      state: 'clean', // clean, infected, immune, patched
      defense: Math.random() < defense ? 0.7 + Math.random()*0.3 : Math.random()*0.3,
      infectedAt: -1,
      connections: 0,
      r: 6 + Math.random()*6,
      pulse: 0,
      guardrails: Math.random() < defense,
    });
  }
  
  // Create edges (small-world-ish)
  for(let i=0;i<agents.length;i++){
    // Connect to 2-5 nearest neighbors
    const dists = agents.map((a,j)=>({j,d:j===i?Infinity:Math.hypot(a.x-agents[i].x, a.y-agents[i].y)}));
    dists.sort((a,b)=>a.d-b.d);
    const numConn = 2 + (Math.random()*3|0);
    for(let k=0;k<numConn && k<dists.length;k++){
      const j = dists[k].j;
      if(!edges.find(e=>(e[0]===i&&e[1]===j)||(e[0]===j&&e[1]===i))){
        edges.push([i,j,0]); // [from, to, infectProgress]
        agents[i].connections++;
        agents[j].connections++;
      }
    }
    // Random long-range connections (small world)
    if(Math.random()<0.15){
      const j = Math.random()*agents.length|0;
      if(j!==i && !edges.find(e=>(e[0]===i&&e[1]===j)||(e[0]===j&&e[1]===i))){
        edges.push([i,j,0]);
        agents[i].connections++;
        agents[j].connections++;
      }
    }
  }
  
  // Run simple physics for layout
  for(let iter=0;iter<100;iter++){
    for(let i=0;i<agents.length;i++){
      agents[i].vx=0;agents[i].vy=0;
      // Repulsion from all
      for(let j=0;j<agents.length;j++){
        if(i===j) continue;
        const dx=agents[j].x-agents[i].x, dy=agents[j].y-agents[i].y;
        const d=Math.max(Math.hypot(dx,dy),1);
        const f=-800/(d*d);
        agents[i].vx+=dx/d*f; agents[i].vy+=dy/d*f;
      }
    }
    // Attraction along edges
    for(const[i,j] of edges){
      const dx=agents[j].x-agents[i].x, dy=agents[j].y-agents[i].y;
      const d=Math.hypot(dx,dy);
      const f=(d-80)*0.01;
      agents[i].vx+=dx/d*f; agents[i].vy+=dy/d*f;
      agents[j].vx-=dx/d*f; agents[j].vy-=dy/d*f;
    }
    // Center gravity
    for(const a of agents){
      a.vx+=(W/2-a.x)*0.005; a.vy+=(H/2-a.y)*0.005;
      a.x+=a.vx*0.3; a.y+=a.vy*0.3;
      a.x=Math.max(pad,Math.min(W-pad,a.x));
      a.y=Math.max(pad,Math.min(H-pad,a.y));
    }
  }
  
  addLog('Network generated: '+count+' agents, '+edges.length+' connections','system');
  updateStats();
  draw();
}

function injectWorm(){
  if(running) return;
  // Pick a random well-connected clean agent as patient zero
  const candidates = agents.filter(a=>a.state==='clean').sort((a,b)=>b.connections-a.connections);
  if(!candidates.length) return;
  const target = candidates[Math.random()*Math.min(3,candidates.length)|0];
  target.state = 'infected';
  target.infectedAt = 0;
  target.pulse = 1;
  addLog('üêõ WORM INJECTED ‚Üí '+target.name+' ('+target.role+')','infect');
  running = true;
  tick = 0;
  simInterval = setInterval(simTick, 300);
}

function deployPatch(){
  if(patchDeployed) return;
  patchDeployed = true;
  // Patch all clean agents with good defense
  let patched = 0;
  for(const a of agents){
    if(a.state==='clean' && a.defense > 0.4){
      a.state = 'patched';
      a.pulse = 0.8;
      patched++;
    }
  }
  addLog('üõ°Ô∏è PATCH DEPLOYED ‚Äî '+patched+' agents hardened','patch');
  document.getElementById('btnPatch').disabled = true;
}

function simTick(){
  tick++;
  const virulence = +document.getElementById('virulence').value / 100;
  
  const newInfections = [];
  
  for(const edge of edges){
    const [i,j] = edge;
    const a = agents[i], b = agents[j];
    
    // Infected spreads to connected clean/patched agents
    if(a.state==='infected' && (b.state==='clean'||b.state==='patched')){
      const attackPower = virulence * (1 + Math.random()*0.3);
      const defensePower = b.defense * (b.state==='patched' ? 2.0 : 1.0);
      if(Math.random() < attackPower * (1 - defensePower * 0.8)){
        newInfections.push({agent:b, from:a});
        edge[2] = 1;
      }
    }
    if(b.state==='infected' && (a.state==='clean'||a.state==='patched')){
      const attackPower = virulence * (1 + Math.random()*0.3);
      const defensePower = a.defense * (a.state==='patched' ? 2.0 : 1.0);
      if(Math.random() < attackPower * (1 - defensePower * 0.8)){
        newInfections.push({agent:a, from:b});
        edge[2] = 1;
      }
    }
  }
  
  // Some infected agents recover (become immune)
  for(const a of agents){
    if(a.state==='infected' && tick - a.infectedAt > 5){
      if(Math.random() < a.defense * 0.3){
        a.state = 'immune';
        a.pulse = 0.8;
        addLog('üí™ '+a.name+' developed immunity','defend');
      }
    }
  }
  
  // Apply infections
  for(const {agent, from} of newInfections){
    if(agent.state==='clean'||agent.state==='patched'){
      const wasPatch = agent.state==='patched';
      agent.state = 'infected';
      agent.infectedAt = tick;
      agent.pulse = 1;
      addLog('üêõ '+from.name+' ‚Üí '+agent.name+(wasPatch?' (PATCH BYPASSED!)':''),'infect');
    }
  }
  
  // Check if simulation is over
  const infected = agents.filter(a=>a.state==='infected').length;
  const clean = agents.filter(a=>a.state==='clean'||a.state==='patched').length;
  if(infected===0 && tick > 1){
    clearInterval(simInterval);
    running = false;
    const immune = agents.filter(a=>a.state==='immune').length;
    addLog('‚úÖ Worm contained! '+immune+' agents immune, '+clean+' survived','system');
  } else if(clean===0 && agents.filter(a=>a.state==='immune').length===0){
    clearInterval(simInterval);
    running = false;
    addLog('üíÄ TOTAL NETWORK COMPROMISE ‚Äî all agents infected','infect');
  }
  
  updateStats();
}

function updateStats(){
  const counts = {clean:0, infected:0, immune:0, patched:0};
  for(const a of agents) counts[a.state]++;
  document.getElementById('sClean').textContent = counts.clean;
  document.getElementById('sInfected').textContent = counts.infected;
  document.getElementById('sImmune').textContent = counts.immune;
  document.getElementById('sPatched').textContent = counts.patched;
  document.getElementById('sTick').textContent = tick;
  
  const total = agents.length || 1;
  document.getElementById('cClean').style.width = (counts.clean/total*100)+'%';
  document.getElementById('cInfected').style.width = (counts.infected/total*100)+'%';
  document.getElementById('cImmune').style.width = (counts.immune/total*100)+'%';
  document.getElementById('cPatched').style.width = (counts.patched/total*100)+'%';
}

function addLog(msg, type){
  const el = document.getElementById('log');
  const d = document.createElement('div');
  d.className = 'log-entry '+type;
  d.textContent = '[T'+tick+'] '+msg;
  el.prepend(d);
  while(el.children.length > 40) el.removeChild(el.lastChild);
}

function draw(){
  ctx.clearRect(0,0,W,H);
  
  // Edges
  for(const[i,j,inf] of edges){
    const a = agents[i], b = agents[j];
    ctx.beginPath();
    ctx.moveTo(a.x, a.y);
    ctx.lineTo(b.x, b.y);
    
    if(a.state==='infected'||b.state==='infected'){
      if(inf > 0){
        ctx.strokeStyle = 'rgba(255,51,102,0.5)';
        ctx.lineWidth = 2;
      } else {
        ctx.strokeStyle = 'rgba(255,51,102,0.15)';
        ctx.lineWidth = 1;
      }
    } else {
      ctx.strokeStyle = COLORS.edge;
      ctx.lineWidth = 0.5;
    }
    ctx.stroke();
  }
  
  // Traveling particles on active edges
  if(running){
    for(const[i,j,inf] of edges){
      if(inf <= 0) continue;
      const a = agents[i], b = agents[j];
      const t = (Date.now()/800) % 1;
      const px = a.x + (b.x-a.x)*t;
      const py = a.y + (b.y-a.y)*t;
      ctx.beginPath();
      ctx.arc(px, py, 2, 0, Math.PI*2);
      ctx.fillStyle = COLORS.infected;
      ctx.fill();
    }
  }
  
  // Agents
  for(const a of agents){
    // Pulse decay
    a.pulse *= 0.95;
    
    // Glow
    if(a.pulse > 0.05){
      const grad = ctx.createRadialGradient(a.x, a.y, a.r, a.x, a.y, a.r + 20*a.pulse);
      const c = a.state==='infected' ? '255,51,102' : a.state==='immune' ? '0,170,255' : a.state==='patched' ? '170,102,255' : '0,255,136';
      grad.addColorStop(0, 'rgba('+c+','+a.pulse*0.4+')');
      grad.addColorStop(1, 'rgba('+c+',0)');
      ctx.beginPath();
      ctx.arc(a.x, a.y, a.r + 20*a.pulse, 0, Math.PI*2);
      ctx.fillStyle = grad;
      ctx.fill();
    }
    
    // Main circle
    ctx.beginPath();
    ctx.arc(a.x, a.y, a.r, 0, Math.PI*2);
    ctx.fillStyle = COLORS[a.state];
    ctx.globalAlpha = a.state==='infected' ? 0.7+Math.sin(Date.now()/200)*0.3 : 0.85;
    ctx.fill();
    ctx.globalAlpha = 1;
    
    // Defense ring
    if(a.guardrails && a.state!=='infected'){
      ctx.beginPath();
      ctx.arc(a.x, a.y, a.r+3, 0, Math.PI*2);
      ctx.strokeStyle = 'rgba(170,102,255,0.5)';
      ctx.lineWidth = 1.5;
      ctx.setLineDash([3,3]);
      ctx.stroke();
      ctx.setLineDash([]);
    }
    
    // Infected skull
    if(a.state==='infected'){
      ctx.fillStyle = '#fff';
      ctx.font = (a.r*0.9)+'px serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText('‚ò†', a.x, a.y+1);
    }
    
    // Hovered
    if(hoveredAgent === a){
      ctx.beginPath();
      ctx.arc(a.x, a.y, a.r+5, 0, Math.PI*2);
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 1.5;
      ctx.stroke();
    }
  }
  
  requestAnimationFrame(draw);
}

// Tooltip
C.addEventListener('pointermove', e=>{
  const rect = C.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;
  
  hoveredAgent = null;
  for(const a of agents){
    if(Math.hypot(a.x-mx, a.y-my) < a.r+8){
      hoveredAgent = a;
      break;
    }
  }
  
  const tt = document.getElementById('tooltip');
  if(hoveredAgent){
    const a = hoveredAgent;
    tt.style.display = 'block';
    tt.style.left = Math.min(e.clientX - C.parentElement.getBoundingClientRect().left + 12, W-230)+'px';
    tt.style.top = (e.clientY - C.parentElement.getBoundingClientRect().top - 60)+'px';
    tt.innerHTML = `
      <div class="name" style="color:${COLORS[a.state]}">${a.name}</div>
      <div class="detail">
        Role: ${a.role}<br>
        Status: <b style="color:${COLORS[a.state]}">${a.state.toUpperCase()}</b><br>
        Defense: ${'‚ñà'.repeat(Math.round(a.defense*10))}${'‚ñë'.repeat(10-Math.round(a.defense*10))} ${(a.defense*100|0)}%<br>
        Guardrails: ${a.guardrails?'‚úÖ Active':'‚ùå None'}<br>
        Connections: ${a.connections}
        ${a.infectedAt>=0?'<br>Infected at tick: '+a.infectedAt:''}
      </div>`;
  } else {
    tt.style.display = 'none';
  }
});

// Tap to infect individual agent
C.addEventListener('click', e=>{
  if(!running && agents.some(a=>a.state==='infected')) return;
  const rect = C.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;
  for(const a of agents){
    if(Math.hypot(a.x-mx, a.y-my) < a.r+8 && a.state==='clean'){
      a.state = 'infected';
      a.infectedAt = tick;
      a.pulse = 1;
      addLog('üéØ Manual inject ‚Üí '+a.name,'infect');
      if(!running){
        running = true;
        tick = 0;
        simInterval = setInterval(simTick, 300);
      }
      updateStats();
      break;
    }
  }
});

// Slider updates
document.getElementById('virulence').oninput = e => document.getElementById('vVirulence').textContent = e.target.value+'%';
document.getElementById('agentCount').oninput = e => document.getElementById('vAgentCount').textContent = e.target.value;
document.getElementById('defense').oninput = e => document.getElementById('vDefense').textContent = e.target.value+'%';

// Buttons
document.getElementById('btnGenerate').onclick = generateNetwork;
document.getElementById('btnInject').onclick = injectWorm;
document.getElementById('btnPatch').onclick = deployPatch;
document.getElementById('btnReset').onclick = ()=>{
  clearInterval(simInterval);
  running = false;
  patchDeployed = false;
  document.getElementById('btnPatch').disabled = false;
  document.getElementById('log').innerHTML = '';
  generateNetwork();
};

// Init
window.addEventListener('resize', ()=>{resize();if(agents.length)draw();});
resize();
generateNetwork();
draw();
</script>
</body>
</html>
